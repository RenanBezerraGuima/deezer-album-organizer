## 2025-05-15 - [Efficient Tree Updates & Selective Subscriptions]
**Learning:** In recursive data structures like folder trees, standard immutable update patterns (like `{ ...folder, subfolders: update(folder.subfolders) }`) often break referential integrity for entire levels of the tree, even when only a single deep node changes. This causes all sibling and parent components to re-render despite being wrapped in `React.memo`. Additionally, subscribing to the entire store state instead of granular pieces triggers re-renders on every state change.
**Action:** Implement "structural sharing" in tree update helpers by checking if children actually changed before creating a new parent object. Use granular Zustand selectors to limit component reactivity. For selection state, use derived selectors like `state => state.selectedId === id` inside children to avoid re-rendering all items when any selection changes.
